<head>
    <script src="https://draeder.github.io/simple-harmonic-oscillator/sho.min.js"></script>
    <script src="https://draeder.github.io/random-walk/walk.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    </head>
    <body>
      <div id="graph1"></div>
      <div id="graph2"></div>
    </body>
    
    <script>
    
    var time = new Date();
    let base = 1
    var data = [{
      x: [time],
      y: [base],
      mode: 'lines',
      line: {color: '#80CAF6'}
    }]
    
    Plotly.newPlot('graph1', data);
    
    var data2 = [{
      x: [time],
      y: [-1,0,1,2,3],
      mode: 'lines',
      line: {color: 'red'}
    }]
    
    Plotly.newPlot('graph2', data2);
    
    
    const sho = new SHO()
    
    let period = 14 // default period for SHO
    let array = []
    let bought = false
    
    sho.on("result", result => {
        //console.log("SHO:",result)
        var time = new Date();
    
        var update = {
            x:  [[time]],
            y: [[result]]
        }
    
        Plotly.extendTraces('graph2', update, [0])
    
        if(result < -60 || result < -40 || result == 0) {
            if(bought == false){
                console.log("BUY - Oversold:", result, "Price:", array.slice(-1)[0])
                bought = true
            }
        }
        
        if(result > 60 || result > 40) {
            if(bought == true){
                console.log("SELL - Overbought:", result, "Price:", array.slice(-1)[0])
                bought = false
            }
        }
    
    })
    
    // Simulate a given stock price
    const stock = new Walk
    
    let speed = [{
    speedMin: 1,
    speedMax: 1500
}]
    
    // This function creates a multiplier to apply realistic price changes for the given base stock price
    function getMultiplier(base) {
        let digits = Math.floor(Math.log10(base)) + 1
        return digits == 6 ? 100000
             : digits == 5 ? 10000
             : digits == 4 ? 1000
             : digits == 3 ? 100
             : digits == 2 ? 10
             : digits == 1 ? 1
             : 0.01
    }
    let multiplier = getMultiplier(base)
    
    stock.on("result", result => {
        //result = Math.abs(base+((result/base)*multiplier)) // Absolute value because stock prices can never be negative
        //console.log("stock",result)
        console.log(result)
        array.push(result)
        sho.get("result", {array}) // send data to get realtime SHO
        var time = new Date();
        var update = {
            x:  [[time]],
            y: [array]
        }
    
        Plotly.extendTraces('graph1', update, [0])
    })
    
    stock.get("walk", speed)
    
    
    
    
    
    </script>